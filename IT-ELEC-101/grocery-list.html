<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Encoding sa characters -->
  <meta charset="UTF-8">
  
  <!-- Para sa responsiveness sa mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- Para sa mga icons nga gamiton -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <!-- Custom nga CSS file para sa grocery list -->
  <link rel="stylesheet" href="style/grocery.css">
</head>
<body>

<div id="main">
  <!-- Header section sa page -->
  <div class="header">
    
    <!-- Button para sa sidebar toggle -->
    <div class="container" onclick="toggleSidebar()">
      <div class="bar1"></div>
      <div class="bar2"></div>
      <div class="bar3"></div>
    </div>
    
    <!-- Search bar para pangitaon ang items -->
    <div class="search-cart-container">
      <input type="text" id="searchBar" placeholder="Search items..." oninput="searchItems()">
    </div>
  </div>

  <!-- Links para sa categories sa items -->
  <div class="categories">
    <a href="#" onclick="filterByCategory('All Products')">All Products</a>
    <a href="#" onclick="filterByCategory('Vegetables')">Vegetables</a>
    <a href="#" onclick="filterByCategory('Fruits')">Fruits</a>
    <a href="#" onclick="filterByCategory('Meals')">Meals</a>
  </div>

  <!-- Heading para sa grocery list -->
  <h2>Grocery List</h2>

  <!-- Div para ipakita ang list sa items -->
  <div id="item-list"></div>
</div>

<!-- Section para sa shopping cart -->
<div id="cart">
  <h3>Shopping Cart</h3>
  <div id="cart-items"></div>
</div>

<!-- Sidebar section -->
<div id="mySidebar" class="sidebar">
  
  <!-- Button para isira ang sidebar -->
  <a href="javascript:void(0)" class="closebtn" onclick="closeSidebar()">&times;</a>
  
  <!-- Link para sa Add Item page -->
  <a href="add-item.html">
    <i class="fas fa-add icon"></i>Add Item</a>

  <!-- Link para sa Shop page -->
  <a href="shop.html">
    <i class="fas fa-shopping-cart icon"></i> Shop</a>
</div>

<script>
  // Function para mo-toggle sa sidebar
  function toggleSidebar() {
    const sidebar = document.getElementById("mySidebar");
    // Check kung ang sidebar kay open or closed
    if (sidebar.style.width === "150px") {
      // Kung open, i-close ang sidebar
      sidebar.style.width = "0";
      document.querySelector(".container").classList.remove("change");
    } else {
      // Kung closed, i-open ang sidebar
      sidebar.style.width = "150px";
      document.querySelector(".container").classList.add("change");
    }
  }

  // Function para isira ang sidebar
  function closeSidebar() {
    document.getElementById("mySidebar").style.width = "0";
    document.querySelector(".container").classList.remove("change");
  }

  // Function para ipakita ang grocery items
  function displayItems(items) {
    const itemList = document.getElementById('item-list');
    itemList.innerHTML = items
      .filter(item => item.status === 'available') // I-filter ang available nga items
      .map((item, index) => `
        <div class="item">
          <img src="${item.productImage}" alt="${item.productName}" class="item-image">
          <div class="item-details">
            <h3>${item.productName}</h3>
            <p>Brand: ${item.brand}</p>
            <p>Price: ₱${item.price}</p> <!-- ₱ symbol para sa price -->
            <p>Weight/Volume: ${item.weight}</p>
            <p>Quantity: ${item.quantity}</p>
            <p>Store: ${item.store}</p>
            <p>Category: ${item.category}</p>
            <button class="edit-btn" onclick="editItem(${index})">
              <i class="fas fa-edit"></i> 
            </button>
            <button class="remove-btn" onclick="removeItem(${index})">
              <i class="fas fa-trash-alt"></i> 
            </button>
          </div>
        </div>
      `)
      .join(''); // Pag-convert og array to HTML string
  }

  // Function para mangita sa items base sa search query
  function searchItems() {
    const searchQuery = document.getElementById('searchBar').value.toLowerCase();
    const items = JSON.parse(localStorage.getItem('items')) || [];
    const filteredItems = items.filter(item =>
      item.productName.toLowerCase().includes(searchQuery) ||
      item.brand.toLowerCase().includes(searchQuery) ||
      item.store.toLowerCase().includes(searchQuery) ||
      item.category.toLowerCase().includes(searchQuery)
    );
    displayItems(filteredItems);
  }

  // Function para mag-filter sa items by category
  function filterByCategory(category) {
    const items = JSON.parse(localStorage.getItem('items')) || [];

    // Kung ang category kay "All Products", ipakita tanan items
    if (category === 'All Products') {
      displayItems(items);
    } else {
      // I-filter ang items base sa gi-select nga category
      const filteredItems = items.filter(item => item.category === category);
      displayItems(filteredItems);
    }
  }

  // Call ang searchItems function pag-load sa page para ipakita tanan items
  document.addEventListener('DOMContentLoaded', searchItems);

  // Function para mag-edit og item gamit ang basic alert
  function editItem(index) {
    const items = JSON.parse(localStorage.getItem('items')) || [];
    const item = items[index];
    const newProductName = prompt('Edit Product Name:', item.productName);
    const newBrand = prompt('Edit Brand:', item.brand);
    const newPrice = prompt('Edit Price (₱):', item.price);
    const newWeight = prompt('Edit Weight/Volume:', item.weight);
    const newQuantity = prompt('Edit Quantity:', item.quantity);
    const newStore = prompt('Edit Store:', item.store);
    const newImage = prompt('Edit Image URL:', item.productImage);

    // Check if all fields are filled in
    if (newProductName && newBrand && newPrice && newWeight && newQuantity && newStore) {
      // Update the item with new values
      items[index] = {
        ...item,
        productName: newProductName,
        brand: newBrand,
        price: newPrice,
        weight: newWeight,
        quantity: newQuantity,
        store: newStore,
        productImage: newImage
      };
      // Save the updated items back to localStorage
      localStorage.setItem('items', JSON.stringify(items));
      searchItems(); // I-update ang display base sa search filter
      alert('Item has been updated.');
    } else {
      alert('Please fill in all fields.'); // Show error message if fields are empty
    }
  }

  // Function para mag-remove og item gamit ang basic alert
  function removeItem(index) {
    // Confirm with user before deleting
    if (confirm('Are you sure you want to delete this item?')) {
      const items = JSON.parse(localStorage.getItem('items')) || [];
      // Remove the item from the list
      items.splice(index, 1);
      // Save the updated list back to localStorage
      localStorage.setItem('items', JSON.stringify(items));
      searchItems(); // I-update ang display base sa search filter
      alert('Item has been deleted.');
    }
  }

  // Call searchItems function on page load to display items
  document.addEventListener('DOMContentLoaded', searchItems);
</script>

</body>
</html>
